version: "3.7"

services:
  traefik:
    image: ${DOCKER_REGISTRY?}/${DOCKER_NAMESPACE?}/traefik-${ENV?}:${TAG?}
    build:
      context: ../
      dockerfile: ./images/traefik/Dockerfile
      target: ${ENV?}
      args:
        - TIMEZONE=${TIMEZONE?}
        - TRAEFIK_VERSION=${TRAEFIK_VERSION?}
        - TRAEFIK_DOMAIN_NAME=${TRAEFIK_DOMAIN_NAME?}
        - TRAEFIK_DOCKER_NETWORK=${TRAEFIK_DOCKER_NETWORK?}
        - TRAEFIK_DOCKER_ENTRYPOINT=${TRAEFIK_DOCKER_ENTRYPOINT?}
        - TRAEFIK_ACME_EMAIL_ADDRESS=${TRAEFIK_ACME_EMAIL_ADDRESS?}
        - TRAEFIK_ACME_DNS_CHALLENGE_PROVIDER=${TRAEFIK_ACME_DNS_CHALLENGE_PROVIDER?}
        - CF_DNS_API_TOKEN=${CLOUDFLARE_API_TOKEN?}

  dockersocket:
    image: ${DOCKER_REGISTRY?}/${DOCKER_NAMESPACE?}/docker-socket-proxy-${ENV?}:${TAG?}
    build:
      context: ../
      dockerfile: ./images/docker-socket-proxy/Dockerfile
      target: ${ENV?}
      args:
        - SOCKET_PROXY_VERSION=${SOCKET_PROXY_VERSION?}

  logger:
    image: ${DOCKER_REGISTRY?}/${DOCKER_NAMESPACE?}/logger-${ENV?}:${TAG?}
    build:
      context: ../
      dockerfile: ./images/logger/Dockerfile
      args:
        - ALPINE_VERSION=${ALPINE_VERSION?}
      target: ${ENV?}
